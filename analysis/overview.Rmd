---
title: "Overview"
author: "Mark Platts"
date: "13 July 2018"
output: html_document
---

```{r, echo = F, message=FALSE, warning=FALSE}
library(here)
library(dplyr)
library(ggplot2)
library(captioner)
library(data.table)
source("https://raw.githubusercontent.com/MarkPlatts/Bee_Clustering_Website/master/code/R/helper_functions.R")
source("https://raw.githubusercontent.com/MarkPlatts/Bee_Clustering_Website/master/code/R/plot_prop_each_cluster.R")
fig_nums <- captioner()
# df_xy <- read.csv(here::here("data/length100/segment_xys.csv"))
df <- fread(here::here("data/length150/segment_features.csv"),
            stringsAsFactors = TRUE)
df_xy <- read.csv(here::here("data/length150/segment_xys.csv"))
arena_coordinates <- draw_arena(xy = df_xy)
```

The goal of this project was to try and detect common movement patterns that bee's exhibited throughout an experiment. We had a dataset that contained the x and y coordinates of bees recorded throughout multiple experiments. Here is a plot that showing the movement of a bee in a single experiment:

```{r, echo = F, fig.width=4, fig.height=5}
df_first_path <- df_xy[df_xy$FileName == "2015-07-14-Sequence-CX-10-03", ]
ggplot(data = droplevels(df_first_path), aes(x_mm, y_mm)) + 
              geom_path() + 
              coord_cartesian(xlim = c(80,240), ylim = c(0,200)) +
              list(geom_path(data = arena_coordinates, aes_string(x = "x", y = "y"))) + 
              theme_bw(base_size = 6) + theme(legend.position="none") +
              ggtitle("No treatment")
```

What can we say about a bee's movement throughout this experiment? We can say that the bee spent more time at the edges of the arena and that generally when the bee traversed the center it did so in a straight line. If we break the path of the bee up into smaller segments we might be able to learn more, but this could take quite a bit of time to do.

By using the ML method in this project, we automated this process and discovered possible categories of bee behaviour, as well as information on how the bees transition between these behaviours thoughout the experiment.

To demonstrate this idea, here are plots for 5 possible types of behaviour that we discovered if we chopped the entire bee's path up into 150mm lengths:

```{r, echo=FALSE}
set.seed(1) #the following code take a random sample of the segments
scaled_df <- scale(df[, MedianDistanceFromCentre:SumAbsoluteAngles])
km.out <- kmeans(x = scaled_df, centers = 5, nstart = 20)
df[, cluster := km.out$cluster]
```

```{r, echo=FALSE, fig.width=7,fig.height=8, message=FALSE}
source("https://raw.githubusercontent.com/MarkPlatts/Bee_Clustering_Website/master/code/R/helper_functions.R")
plot_cluster(features = df, xy = as.data.table(df_xy), kmean_mod = km.out, nSegments = 5)
```

By looking at these samples we can now start to form hypothesis for how the bee is behaving at different points within the experiments.

We can also calculate/plot how much of the time a bee spends in each cluster of behaviour. This is especially useful if we want to compare how the bee's behaviour changes as a result of different treatments:

```{r echo=FALSE}
plot_prop_each_cluster(segment_length = 150, n_clusters = 5)
```

Combining this information with the cluster plots above we can say things like Procaine increases the amount of time that bees hardly move around, or that Procaine reduces the amount of time spent exploring smaller regions.
